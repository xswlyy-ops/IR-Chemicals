<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Laboratory Barcode Inventory</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
  body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #f6f8fa;
  padding: 10px;
  max-width: 520px;
  margin: auto;
}

/* åŒºå— */
.section {
  background: #fff;
  border-radius: 8px;
  padding: 10px;
  margin-bottom: 12px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}

/* æ‰«æçª—å£ï¼šæ‰‹æœºä¼˜å…ˆ */
#reader {
  width: 100%;
  height: 45vh;        /* å…³é”®ï¼šå æ‰‹æœºé«˜åº¦ */
  min-height: 260px;
  max-height: 420px;
  border: 1px solid #ccc;
  margin-bottom: 8px;
}

/* æ–‡æœ¬ */
h3 {
  margin: 6px 0 10px;
  font-size: 18px;
}

label {
  font-weight: 600;
  margin-top: 6px;
  display: block;
  font-size: 14px;
}

/* è¾“å…¥æ¡† */
input {
  width: 100%;
  padding: 7px;
  margin-top: 4px;
  font-size: 14px;
}

/* æŒ‰é’®ï¼šä¸å¤¸å¼  */
button {
  width: 100%;
  padding: 8px;
  margin-top: 8px;
  font-size: 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

/* æŒ‰é’®é…è‰² */
.primary { background: #2da44e; color: white; }
.secondary { background: #0969da; color: white; }
.danger { background: #cf222e; color: white; }

/* çŠ¶æ€æç¤º */
#status {
  font-size: 13px;
  margin-top: 4px;
  color: #2da44e;
}

/* è¡¨æ ¼ */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

th, td {
  border: 1px solid #ccc;
  padding: 5px;
  text-align: center;
}

th {
  background: #f0f2f4;
}

/* æ¡Œé¢ç«¯å¾®è°ƒ */
@media (min-width: 768px) {
  #reader {
    height: 320px;
  }

  body {
    max-width: 640px;
  }
}

</style>
</head>

<body>

<h3>ğŸ“¦ Laboratory Chemical Labeling</h3>

<div class="section">
  <div id="reader"></div>
  <button class="secondary" onclick="switchCamera()">Switch Camera</button>
  <div id="status">Ready to scan</div>
</div>

<div class="section">
  <label>Barcode / Label (editable)</label>
  <input id="codeInput" placeholder="Scan barcode or enter manually">

  <label>Chemical / Sample Name</label>
  <input id="nameInput" placeholder="e.g. Lithium salt">

  <label>Storage Location</label>
  <input id="locationInput" placeholder="e.g. Fridge B-1">

  <button class="primary" onclick="addRecord()">Add Record</button>
</div>

<div class="section">
  <button class="danger" onclick="exportCSV()">Export CSV (Excel)</button>
</div>

<div class="section">
  <h3>Current Records</h3>
  <table id="recordTable">
    <thead>
      <tr>
        <th>Barcode</th>
        <th>Name</th>
        <th>Location</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const html5QrCode = new Html5Qrcode("reader");
  let facingMode = "environment";
  let locked = false;
  const records = [];

  function startScanner() {
    html5QrCode.start(
      { facingMode },
      {
        fps: 10,
        qrbox: { width: 800, height: 200 },
        formatsToSupport: [
          Html5QrcodeSupportedFormats.CODE_128,
          Html5QrcodeSupportedFormats.EAN_13,
          Html5QrcodeSupportedFormats.EAN_8,
          Html5QrcodeSupportedFormats.UPC_A,
          Html5QrcodeSupportedFormats.UPC_E
        ]
      },
      (decodedText) => {
        if (locked) return;

        locked = true;
        document.getElementById("codeInput").value = decodedText;
        document.getElementById("status").innerText = "âœ” Barcode captured";

        html5QrCode.pause();
        setTimeout(() => {
          html5QrCode.resume();
          locked = false;
          document.getElementById("status").innerText = "Ready to scan";
        }, 1200);
      }
    );
  }

  function switchCamera() {
    html5QrCode.stop().then(() => {
      facingMode = facingMode === "environment" ? "user" : "environment";
      startScanner();
    });
  }

  function addRecord() {
    const code = codeInput.value.trim();
    const name = nameInput.value.trim();
    const location = locationInput.value.trim();
    const time = new Date().toLocaleString();

    if (!code || !name || !location) {
      alert("Please complete all fields");
      return;
    }

    const record = { code, name, location, time };
    records.push(record);

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${record.code}</td>
      <td>${record.name}</td>
      <td>${record.location}</td>
      <td>${record.time}</td>
    `;
    document.querySelector("#recordTable tbody").appendChild(row);

    nameInput.value = "";
    locationInput.value = "";
  }

  function exportCSV() {
    if (records.length === 0) {
      alert("No records available");
      return;
    }

    let csv = "Barcode,Name,Location,Timestamp\n";
    records.forEach(r => {
      csv += `"${r.code}","${r.name}","${r.location}","${r.time}"\n`;
    });

    const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "lab_inventory.csv";
    a.click();
    URL.revokeObjectURL(url);
  }

  startScanner();
</script>

</body>
</html>
